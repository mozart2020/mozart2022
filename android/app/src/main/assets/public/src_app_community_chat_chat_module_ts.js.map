{"version":3,"file":"src_app_community_chat_chat_module_ts.js","mappings":"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","sources":["./src/app/community/chat/chat-routing.module.ts","./src/app/community/chat/chat.module.ts","./src/app/community/chat/chat.page.ts","./node_modules/@capacitor/camera/dist/esm/definitions.js","./node_modules/@capacitor/camera/dist/esm/index.js"],"sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { ChatPage } from './chat.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: ChatPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class ChatPageRoutingModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { ChatPageRoutingModule } from './chat-routing.module';\r\n\r\nimport { ChatPage } from './chat.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    ChatPageRoutingModule\r\n  ],\r\n  declarations: [ChatPage]\r\n})\r\nexport class ChatPageModule {}\r\n","import { Component, OnInit, ViewChild } from '@angular/core';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { Camera, CameraResultType, CameraSource } from '@capacitor/camera';\r\nimport { IonContent } from '@ionic/angular';\r\nimport { map, switchMap } from 'rxjs/operators';\r\nimport { AuthService } from 'src/app/services/auth.service';\r\nimport { UserService } from 'src/app/services/user.service';\r\nimport { VideoService } from 'src/app/services/video.service';\r\n\r\n@Component({\r\n  selector: 'app-chat',\r\n  templateUrl: './chat.page.html',\r\n  styleUrls: ['./chat.page.scss'],\r\n})\r\nexport class ChatPage implements OnInit {\r\n  @ViewChild(IonContent) content: IonContent;\r\n  connectionId: string;\r\n  currentUserId: string;\r\n  friendId: string;\r\n  friendName: '';\r\n  friendEmail: string;\r\n  msg = '';\r\n  messages = [];\r\n\r\n  constructor(\r\n    private route: ActivatedRoute,\r\n    private authService: AuthService,\r\n    private userService: UserService,\r\n    private videoService: VideoService) { }\r\n\r\n  ngOnInit() {\r\n    this.connectionId = this.route.snapshot.paramMap.get('id');\r\n    this.currentUserId = this.authService.getCurrentUserId();\r\n    this.userService.getChatMessages(this.connectionId).subscribe(res => {\r\n      for(let m of res) {\r\n        if (this.messages.filter(msg => msg.id == m.id).length == 0) {\r\n          this.messages.push(m);\r\n        }\r\n      }\r\n      console.log('messages: ', this.messages);\r\n      setTimeout(() => {\r\n        this.content.scrollToBottom(400);\r\n      }, 400)\r\n    });\r\n    this.userService.getConnectionInfo(this.connectionId).subscribe(res => {\r\n      console.log('user ids of connection: ', res.users);\r\n      for(let user of res.users) {\r\n        if(user != this.currentUserId) {\r\n          this.friendId = user;\r\n        }\r\n      }\r\n      this.userService.getUserById(this.friendId).subscribe(res => {\r\n        console.log('friend info: ', res);\r\n        this.friendEmail = res.email;\r\n        this.friendName = res.name;\r\n      })\r\n    });\r\n    \r\n  }\r\n  sendMsg() {\r\n    this.userService.addMessage(this.connectionId, this.msg).then(_ =>{\r\n      this.msg='';\r\n      this.content.scrollToBottom(300);\r\n    })\r\n  }\r\n  async takeImage() {\r\n    const image = await Camera.getPhoto({\r\n      quality: 60,\r\n      allowEditing: false,\r\n      source: CameraSource.Camera,\r\n      resultType: CameraResultType.Base64\r\n    });\r\n    if(image) {\r\n      console.log('image: ', image.base64String)\r\n      this.videoService.addImageMsg(image.base64String, this.connectionId);\r\n    }\r\n  }\r\n}\r\n","export var CameraSource;\n(function (CameraSource) {\n    /**\n     * Prompts the user to select either the photo album or take a photo.\n     */\n    CameraSource[\"Prompt\"] = \"PROMPT\";\n    /**\n     * Take a new photo using the camera.\n     */\n    CameraSource[\"Camera\"] = \"CAMERA\";\n    /**\n     * Pick an existing photo fron the gallery or photo album.\n     */\n    CameraSource[\"Photos\"] = \"PHOTOS\";\n})(CameraSource || (CameraSource = {}));\nexport var CameraDirection;\n(function (CameraDirection) {\n    CameraDirection[\"Rear\"] = \"REAR\";\n    CameraDirection[\"Front\"] = \"FRONT\";\n})(CameraDirection || (CameraDirection = {}));\nexport var CameraResultType;\n(function (CameraResultType) {\n    CameraResultType[\"Uri\"] = \"uri\";\n    CameraResultType[\"Base64\"] = \"base64\";\n    CameraResultType[\"DataUrl\"] = \"dataUrl\";\n})(CameraResultType || (CameraResultType = {}));\n","import { registerPlugin } from '@capacitor/core';\nconst Camera = registerPlugin('Camera', {\n    web: () => import('./web').then(m => new m.CameraWeb()),\n});\nexport * from './definitions';\nexport { Camera };\n"],"names":[],"sourceRoot":"webpack:///"}